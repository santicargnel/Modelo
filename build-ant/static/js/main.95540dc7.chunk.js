(this["webpackJsonpcarribar-app"]=this["webpackJsonpcarribar-app"]||[]).push([[0],{13:function(e,t,a){},15:function(e,t,a){"use strict";a.r(t);var o=a(2),n=a(4),i=(a(13),a(1)),s=a(0);const r={1:[{key:"Sin Mayo",label:"Sin Mayo",delta:0},{key:"Con Mostaza",label:"Con Mostaza",delta:0},{key:"Con Ketchup",label:"Con Ketchup",delta:0}],2:[{key:"Sin Mayo",label:"Sin Mayo",delta:0},{key:"Con Mostaza",label:"Con Mostaza",delta:0},{key:"Con Ketchup",label:"Con Ketchup",delta:0}],3:[{key:"Sin Lechuga",label:"Sin Lechuga",delta:0},{key:"Sin Tomate",label:"Sin Tomate",delta:0},{key:"Sin Mayo",label:"Sin Mayo",delta:0},{key:"Con Mostaza",label:"Con Mostaza",delta:0},{key:"Con Ketchup",label:"Con Ketchup",delta:0}],4:[{key:"Sin Lechuga",label:"Sin Lechuga",delta:0},{key:"Sin Tomate",label:"Sin Tomate",delta:0},{key:"Sin Mayo",label:"Sin Mayo",delta:0},{key:"Con Mostaza",label:"Con Mostaza",delta:0},{key:"Con Ketchup",label:"Con Ketchup",delta:0}],5:[{key:"Sin Lechuga",label:"Sin Lechuga",delta:0},{key:"Sin Tomate",label:"Sin Tomate",delta:0},{key:"Sin Mayo",label:"Sin Mayo",delta:0},{key:"Sin Huevo",label:"Sin Huevo",delta:200},{key:"Sin Queso",label:"Sin Queso",delta:-100},{key:"Sin Jamon",label:"Sin Jamon",delta:-100}],6:[{key:"Sin Lechuga",label:"Sin Lechuga",delta:0},{key:"Sin Tomate",label:"Sin Tomate",delta:0},{key:"Sin Mayo",label:"Sin Mayo",delta:0},{key:"Sin Huevo",label:"Sin Huevo",delta:-200},{key:"Sin Queso",label:"Sin Queso",delta:-100},{key:"Sin Jamon",label:"Sin Jamon",delta:-100}],7:[{key:"Sin Lechuga",label:"Sin Lechuga",delta:0},{key:"Sin Tomate",label:"Sin Tomate",delta:0},{key:"Sin Mayo",label:"Sin Mayo",delta:0},{key:"Con Mostaza",label:"Con Mostaza",delta:0},{key:"Con Ketchup",label:"Con Ketchup",delta:0}],8:[{key:"Sin Lechuga",label:"Sin Lechuga",delta:0},{key:"Sin Tomate",label:"Sin Tomate",delta:0},{key:"Sin Mayo",label:"Sin Mayo",delta:0},{key:"Sin Huevo",label:"Sin Huevo",delta:0},{key:"Sin Queso",label:"Sin Queso",delta:0},{key:"Sin Jamon",label:"Sin Jamon",delta:0}],9:[{key:"Sin Lechuga",label:"Sin Lechuga",delta:0},{key:"Sin Tomate",label:"Sin Tomate",delta:0},{key:"Sin Mayo",label:"Sin Mayo",delta:0},{key:"Con Mostaza",label:"Con Mostaza",delta:0},{key:"Con Ketchup",label:"Con Ketchup",delta:0}],10:[{key:"Sin Lechuga",label:"Sin Lechuga",delta:0},{key:"Sin Tomate",label:"Sin Tomate",delta:0},{key:"Sin Mayo",label:"Sin Mayo",delta:0},{key:"Sin Huevo",label:"Sin Huevo",delta:0},{key:"Sin Queso",label:"Sin Queso",delta:0},{key:"Sin Jamon",label:"Sin Jamon",delta:0}],11:[{key:"Sin Lechuga",label:"Sin Lechuga",delta:0},{key:"Sin Tomate",label:"Sin Tomate",delta:0},{key:"Sin Mayo",label:"Sin Mayo",delta:0},{key:"Con Mostaza",label:"Con Mostaza",delta:0},{key:"Con Ketchup",label:"Con Ketchup",delta:0}],12:[{key:"Sin Lechuga",label:"Sin Lechuga",delta:0},{key:"Sin Tomate",label:"Sin Tomate",delta:0},{key:"Sin Mayo",label:"Sin Mayo",delta:0},{key:"Sin Huevo",label:"Sin Huevo",delta:0},{key:"Sin Queso",label:"Sin Queso",delta:0},{key:"Sin Jamon",label:"Sin Jamon",delta:0}],13:[{key:"Sin Lechuga",label:"Sin Lechuga",delta:0},{key:"Sin Tomate",label:"Sin Tomate",delta:0},{key:"Sin Mayo",label:"Sin Mayo",delta:0},{key:"Con Mostaza",label:"Con Mostaza",delta:0},{key:"Con Ketchup",label:"Con Ketchup",delta:0}],14:[{key:"Sin Lechuga",label:"Sin Lechuga",delta:0},{key:"Sin Tomate",label:"Sin Tomate",delta:0},{key:"Sin Mayo",label:"Sin Mayo",delta:0},{key:"Sin Huevo",label:"Sin Huevo",delta:0},{key:"Sin Queso",label:"Sin Queso",delta:0},{key:"Sin Jamon",label:"Sin Jamon",delta:0}]},l=[{id:1,nombre:"Hamb c/cheddar simple",precio:8600},{id:2,nombre:"Hamb c/cheddar doble",precio:10300},{id:3,nombre:"Hamb comun simple",precio:8600},{id:4,nombre:"Hamb comun doble",precio:10300},{id:5,nombre:"Hamb completa simple",precio:10200},{id:6,nombre:"Hamb completa doble",precio:11900},{id:7,nombre:"Patynesa comun",precio:9e3},{id:8,nombre:"Patynesa completa",precio:10400},{id:9,nombre:"Lomito comun",precio:11400},{id:10,nombre:"Lomito completo",precio:12800},{id:11,nombre:"Mila sandwich comun",precio:1e4},{id:12,nombre:"Mila sandwich completo",precio:11400},{id:13,nombre:"Suprema sand. comun",precio:9e3},{id:14,nombre:"Suprema sand. completo",precio:10400},{id:15,nombre:"Tostado",precio:6e3},{id:16,nombre:"Carlitos",precio:6e3},{id:17,nombre:"Pizzanesa carne",precio:2e4},{id:18,nombre:"Pizzanesa pollo",precio:18e3},{id:19,nombre:"Milanesa al plato",precio:9e3},{id:20,nombre:"Suprema al plato",precio:8e3},{id:21,nombre:"Milanesa napo",precio:1e4},{id:22,nombre:"Suprema napo",precio:9e3},{id:23,nombre:"Milanesa picada",precio:9e3},{id:24,nombre:"Suprema picada",precio:8e3},{id:25,nombre:"Milanesa cheddar/grati",precio:1e4},{id:26,nombre:"Suprema cheddar/grati",precio:9e3},{id:27,nombre:"Milanesa a caballo",precio:1e4},{id:28,nombre:"Suprema a caballo",precio:9e3},{id:29,nombre:"Fritas porcion",precio:6e3},{id:30,nombre:"Fritas media porcion",precio:4e3},{id:31,nombre:"Fritas porcion c/cheddar",precio:7e3},{id:32,nombre:"Fritas media c/cheddar",precio:5e3},{id:33,nombre:"Cheddar agreg. porcion",precio:1800},{id:34,nombre:"Cheddar agreg. media",precio:1e3},{id:35,nombre:"Nuggets 10un",precio:5e3},{id:36,nombre:"Nuggets 10un c/cheddar",precio:6e3},{id:37,nombre:"Pizza jym o napolitana",precio:12e3},{id:38,nombre:"Gaseosa chica",precio:2500},{id:39,nombre:"Gaseosa 1.5l",precio:5e3},{id:40,nombre:"Coca vidrio",precio:4500},{id:41,nombre:"Fernet Jarra",precio:8e3},{id:42,nombre:"Agua/Sabor. chica",precio:2e3},{id:43,nombre:"Agua/Sabar. grande",precio:3500},{id:44,nombre:"Cerveza Santa Fe Lata",precio:2500},{id:45,nombre:"Cerveza Santa Fe Botella",precio:5e3},{id:46,nombre:"Delivery",precio:1500},{id:47,nombre:"Sin papas",precio:-2e3}],c={seleccionados:{},ventaConfirmada:!1,ventas:[],montoPagado:0,numeroVentaActual:1001,ventasAnteriores:[],mensajeTicket:"",lugarConsumo:"Aca",medioPagoActual:"Efectivo",cierresCaja:[],ultimoCierreISO:"",pagosActuales:{Efectivo:0,"D\xe9bito":0,"Cr\xe9dito":0,QR:0,Cuenta:0},pagos:[],modificadores:{},lineas:[],comandas:[],comandaEnProcesoId:null},d=["Efectivo","D\xe9bito","Cr\xe9dito","QR","Cuenta"],p={Efectivo:0,"D\xe9bito":0,"Cr\xe9dito":0,QR:0,Cuenta:0},u=e=>e.toLocaleString("es-AR",{minimumFractionDigits:0,maximumFractionDigits:0}),b=()=>{const e=new Date,t=new Intl.DateTimeFormat("es-AR",{timeZone:"America/Argentina/Cordoba",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).formatToParts(e).reduce((e,t)=>(e[t.type]=t.value,e),{}),a=t.year,o=t.month,n=t.day,i=t.hour,s=t.minute,r=t.second;return{fecha:"".concat(n,"-").concat(o,"-").concat(a),hora:"".concat(i,":").concat(s,":").concat(r),createdAtISO:"".concat(a,"-").concat(o,"-").concat(n,"T").concat(i,":").concat(s,":").concat(r,"-03:00")}},m=e=>d.reduce((t,a)=>t+(Number(e[a])||0),0),h=e=>{let{children:t,bg:a,color:n,hoverBg:i,hoverColor:r,onClick:l}=e;const[c,d]=Object(o.useState)(!1);return Object(s.jsx)("button",{onClick:l,onMouseEnter:()=>d(!0),onMouseLeave:()=>d(!1),style:{backgroundColor:c?i:a,color:c?r:n,cursor:"pointer",borderRadius:"4px",padding:"6px 14px",fontSize:"0.9rem",fontFamily:"Montserrat, sans-serif",fontWeight:700,border:"none",transition:"0.2s ease-in-out"},children:t})};var g=()=>{const[e,t]=Object(o.useState)(()=>{try{const e=localStorage.getItem("estado");if(e){const t=JSON.parse(e),a=t&&"string"===typeof t.medioPagoActual?t.medioPagoActual:"Efectivo";return Object(i.a)(Object(i.a)(Object(i.a)({},c),t||{}),{},{medioPagoActual:a,pagosActuales:Object(i.a)(Object(i.a)({},p),t&&t.pagosActuales?t.pagosActuales:{}),pagos:t&&Array.isArray(t.pagos)?t.pagos:[],modificadores:t&&t.modificadores||{},lineas:t&&Array.isArray(t.lineas)?t.lineas:[],comandas:t&&Array.isArray(t.comandas)?t.comandas:[],comandaEnProcesoId:t&&"string"===typeof t.comandaEnProcesoId?t.comandaEnProcesoId:null})}}catch(e){console.error("Error leyendo localStorage",e)}return Object(i.a)(Object(i.a)({},c),{},{pagosActuales:Object(i.a)({},p),pagos:[],modificadores:{},lineas:[],comandas:[],comandaEnProcesoId:null})});Object(o.useEffect)(()=>{try{localStorage.setItem("estado",JSON.stringify(e))}catch(t){console.error("Error guardando localStorage",t)}},[e]);const[a,n]=Object(o.useState)(!1),[g,j]=Object(o.useState)({Efectivo:0,"D\xe9bito":0,"Cr\xe9dito":0,QR:0,Cuenta:0}),[x,y]=Object(o.useState)(!1),[f,v]=Object(o.useState)(null),[O,S]=Object(o.useState)(null),[C,k]=Object(o.useState)({b100:"",b200:"",b500:"",b1000:"",b2000:"",b10000:"",b20000:""}),[w,N]=Object(o.useState)({bica:"",mp:"",macro:""}),T={b100:100,b200:200,b500:500,b1000:1e3,b2000:2e3,b10000:1e4,b20000:2e4},I=["b100","b200","b500","b1000","b2000","b10000","b20000"],M=()=>I.reduce((e,t)=>e+Number(C[t]||0)*(T[t]||0),0),A=()=>Number(w.bica||0)+Number(w.macro||0),z=()=>{j(e.pagosActuales||Object(i.a)({},p)),n(!0)},P=()=>n(!1),E=e=>({uid:Math.random().toString(36).slice(2)+Date.now().toString(36),productoId:e.productoId,mods:Object(i.a)({},e.mods||{}),qty:e.qty||1}),R=e=>{const t={};return e.forEach(e=>{t[e.productoId]=(t[e.productoId]||0)+(e.qty||1)}),t},D=e=>e.lineas.reduce((e,t)=>e+(e=>{const t=l.find(t=>t.id===e.productoId);if(!t)return 0;const a=_(e.productoId,e.mods);return(t.precio+a)*(e.qty||1)})(t),0),V=()=>e.lineas.reduce((e,t)=>{const a=l.find(e=>e.id===t.productoId);if(!a)return e;const o=_(t.productoId,t.mods);return e+(a.precio+o)*(t.qty||1)},0),$=(t,a)=>{const{fecha:o}=b(),n=window.open("","Ticket","width=300,height=500");if(!n)return void alert("No se pudo abrir la ventana de impresi\xf3n. Revis\xe1 el bloqueador de pop-ups.");const i=[];if(i.push('<div class="ticket">'),i.push('<p style="font-weight:bold; font-size:16px; margin:0; text-align:center;">Carribar San Jorge</p>'),i.push('<p style="font-weight:bold; font-size:12px; margin:0; text-align:center;">Fecha: '+o+"</p>"),i.push('<p style="font-weight:bold; font-size:12px; margin:0; text-align:center;">N\xb0 Ticket: '+e.numeroVentaActual+"</p>"),i.push('<div style="border-top:1px dashed #000; margin:4px 0 0 0;"></div>'),t.forEach(e=>{const t=e.precio*e.cantidad;i.push('<div style="display:flex; align-items:center; font-size:14px; font-weight:bold; margin:0;"><span style="width:10%; text-align:center;">'+e.cantidad+'x</span><span style="width:60%; text-align:center;">'+e.producto+'</span><span style="width:30%; text-align:center;">$'+u(t)+"</span></div>"),e.mensajeTicket&&i.push('<div style="font-size:10px; text-align:left; margin:0 0 2px 0; padding-left:2px;">&gt; '+e.mensajeTicket+"</div>"),i.push('<div style="border-bottom:1px dotted #000; margin:2px 0;"></div>')}),i.push('<div style="border-top:1px dashed #000; margin:4px 0;"></div>'),i.push('<p style="font-weight:bold; font-size:14px; margin:0;">Obs: '+(e.mensajeTicket||"")+"</p>"),i.push('<p style="font-weight:bold; font-size:14px; margin:0; text-align:left;">Lugar consumo: '+e.lugarConsumo+"</p>"),a){const e=d.filter(e=>(a[e]||0)>0);e.length&&(i.push('<div style="border-top:1px dashed #000; margin:4px 0;"></div>'),i.push('<p style="font-weight:bold; font-size:10px; margin:0; text-align:left;">Pagos:</p>'),e.forEach(e=>{i.push('<div style="display:flex; justify-content:space-between; font-size:10px;">'+"<span>".concat(e,"</span><span>$").concat(u(a[e]),"</span>")+"</div>")}))}i.push('<p style="font-weight:bold; font-size:16px; margin:4px 0 0 0; text-align:center; border:2px solid #000; padding:4px;">'),i.push("  Total: $"+u(t.reduce((e,t)=>e+t.precio*t.cantidad,0))),i.push("</p>"),i.push("</div>"),n.document.write(i.join("")),n.document.close(),n.print(),n.close()},[L,F]=Object(o.useState)(!1),[B,q]=Object(o.useState)(""),Q=()=>F(!1),H=e=>{t(t=>{const a=t.comandas.find(t=>t.id===e);if(!a)return t;const o=a.lineas.map(E);return Object(i.a)(Object(i.a)({},t),{},{lineas:o,seleccionados:R(o),comandaEnProcesoId:e,mensajeTicket:a.obs||"",pagosActuales:Object(i.a)({},p)})}),F(!1)},J=e=>r[e]||[],_=(e,t)=>J(e).reduce((e,a)=>e+((t[a.key]?a.delta:0)||0),0),W=(e,t)=>J(e).filter(e=>!!t[e.key]).map(e=>e.delta>0?"".concat(e.label," (+$").concat(u(e.delta),")"):e.label).join(" | ");return Object(s.jsx)(s.Fragment,{children:Object(s.jsxs)("div",{className:"w-full p-4 md:p-6 lg:p-8 bg-white rounded-lg shadow-md",children:[Object(s.jsx)("h1",{className:"titulo",children:"CARRIBAR SAN JORGE"}),Object(s.jsxs)("p",{className:"venta-numero",children:["Venta N\xb0 ",e.numeroVentaActual]}),Object(s.jsx)("div",{className:"mb-4 border-4 border-green-600 p-2 rounded-lg",children:Object(s.jsx)("div",{className:"productos-grid w-full",children:l.map(e=>Object(s.jsxs)("button",{className:"producto-btn",onClick:()=>{return a=e.id,t(e=>{const t=e.lineas.findIndex(e=>e.productoId===a&&0===Object.keys(e.mods||{}).length);let o;var n;o=-1!==t?e.lineas.map((e,a)=>a===t?Object(i.a)(Object(i.a)({},e),{},{qty:(e.qty||1)+1}):e):[...e.lineas,(n=a,{uid:Math.random().toString(36).slice(2)+Date.now().toString(36),productoId:n,mods:{},qty:1})];const s=Object(i.a)({},e.seleccionados);return s[a]=(s[a]||0)+1,Object(i.a)(Object(i.a)({},e),{},{lineas:o,seleccionados:s})});var a},children:[Object(s.jsx)("span",{className:"mr-1",children:e.nombre}),Object(s.jsxs)("span",{className:"text-red-600 whitespace-nowrap",children:["$",u(e.precio)]})]},e.id))})}),Object(s.jsx)("h2",{className:"subtitulo alto-unico",children:"Productos seleccionados"}),Object(s.jsx)("ul",{className:"list-none lista",children:0===e.lineas.length?Object(s.jsx)("li",{className:"text-center text-gray-500",children:"No hay productos agregados."}):e.lineas.map(e=>{const a=l.find(t=>t.id===e.productoId),o=J(e.productoId),n=_(e.productoId,e.mods),r=a?a.precio+n:0,c=r*(e.qty||1);return Object(s.jsxs)("li",{className:"item-linea",children:[Object(s.jsxs)("div",{className:"item-linea-texto",children:[Object(s.jsxs)("span",{className:"font-medium",children:[null===a||void 0===a?void 0:a.nombre,": ",e.qty||1," ",1===(e.qty||1)?"Unidad":"Unidades"]}),Object(s.jsxs)("span",{className:"precio-unit",children:["\u2014 $",u(r)," c/u"]}),Object(s.jsxs)("span",{className:"precio-total",children:["\u2014 Total: $",u(c)]})]}),Object(s.jsxs)("div",{className:"item-linea-botones",children:[Object(s.jsx)("button",{className:"boton-duplicar",onClick:()=>{return a=e.uid,t(e=>{const t=e.lineas.find(e=>e.uid===a);if(!t)return e;const o={uid:Math.random().toString(36).slice(2)+Date.now().toString(36),productoId:t.productoId,mods:Object(i.a)({},t.mods),qty:1},n=[...e.lineas,o],s=Object(i.a)({},e.seleccionados);return s[t.productoId]=(s[t.productoId]||0)+1,Object(i.a)(Object(i.a)({},e),{},{lineas:n,seleccionados:s})});var a},title:"Sumar 1 a esta l\xednea",children:"Duplicar"}),Object(s.jsx)("button",{className:"boton-eliminar",onClick:()=>{return a=e.uid,t(e=>{const t=e.lineas.findIndex(e=>e.uid===a);if(-1===t)return e;const o=e.lineas[t].productoId,n=e.lineas.slice();n.splice(t,1);const s=Object(i.a)({},e.seleccionados);return(s[o]||0)>1?s[o]--:delete s[o],Object(i.a)(Object(i.a)({},e),{},{lineas:n,seleccionados:s})});var a},title:"Quitar toda la l\xednea",children:"Eliminar"})]}),o.length>0&&Object(s.jsx)("div",{className:"item-linea-mods",children:o.map(a=>Object(s.jsxs)("label",{className:"mod-label",children:[Object(s.jsx)("input",{type:"checkbox",checked:!!e.mods[a.key],onChange:o=>t(t=>{const n=t.lineas.map(t=>t.uid===e.uid?Object(i.a)(Object(i.a)({},t),{},{mods:Object(i.a)(Object(i.a)({},t.mods),{},{[a.key]:o.target.checked})}):t);return Object(i.a)(Object(i.a)({},t),{},{lineas:n})})}),Object(s.jsxs)("span",{children:[a.label,0!==a.delta&&Object(s.jsxs)("span",{className:a.delta>0?"mod-plus":"mod-minus",children:["(",a.delta>0?"+":"-","$",u(Math.abs(a.delta)),")"]})]})]},a.key))})]},e.uid)})}),Object(s.jsxs)("p",{className:"total-precio alto-unico",children:["Total: $",u(V())]}),Object(s.jsxs)("div",{className:"consumo-y-aclaraciones alto-unico",children:[Object(s.jsxs)("div",{className:"consumo-opciones",children:[Object(s.jsx)("span",{className:"label-consumo",children:"Lugar de consumo:"}),Object(s.jsxs)("label",{className:"consumo-item",children:[Object(s.jsx)("input",{type:"radio",name:"lugarConsumo",value:"Aca",checked:"Aca"===e.lugarConsumo,onChange:()=>t(e=>Object(i.a)(Object(i.a)({},e),{},{lugarConsumo:"Aca"}))}),"Aca"]}),Object(s.jsxs)("label",{className:"consumo-item",children:[Object(s.jsx)("input",{type:"radio",name:"lugarConsumo",value:"Delivery",checked:"Delivery"===e.lugarConsumo,onChange:()=>t(e=>Object(i.a)(Object(i.a)({},e),{},{lugarConsumo:"Delivery"}))}),"Delivery"]}),Object(s.jsxs)("label",{className:"consumo-item",children:[Object(s.jsx)("input",{type:"radio",name:"lugarConsumo",value:"Retira",checked:"Retira"===e.lugarConsumo,onChange:()=>t(e=>Object(i.a)(Object(i.a)({},e),{},{lugarConsumo:"Retira"}))}),"Retira"]})]}),Object(s.jsx)("input",{type:"text",placeholder:"Aclaraciones del pedido (opcional)",value:e.mensajeTicket,onChange:e=>t(t=>Object(i.a)(Object(i.a)({},t),{},{mensajeTicket:e.target.value})),className:"aclaraciones-input"})]}),Object(s.jsxs)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:"8px",marginTop:"16px",marginBottom:"16px",width:"100%"},children:[Object(s.jsx)("button",{className:"btn-base btn-comanda",onClick:()=>{if(0===e.lineas.length)return void alert("No hay productos seleccionados.");const a=window.open("","Comanda","width=300,height=500");if(!a)return void alert("No se pudo abrir la ventana de impresi\xf3n. Revis\xe1 el bloqueador de pop-ups.");const o=(e=>{var t,a;const{fecha:o,hora:n,createdAtISO:i}=b();return{id:(null===(t=(a=crypto).randomUUID)||void 0===t?void 0:t.call(a))||Math.random().toString(36).slice(2)+Date.now().toString(36),fecha:o,hora:n,createdAtISO:i,numeroSugerido:e.numeroVentaActual,lineas:e.lineas.map(E),estado:"pendiente",obs:e.mensajeTicket||""}})(e);t(e=>Object(i.a)(Object(i.a)({},e),{},{comandas:[...e.comandas,o]}));const{fecha:n}=b(),s=[];s.push("<html><head><meta charset='utf-8'/>"),s.push("\n    <style>\n      @media print { @page { size: 80mm auto; margin: 2mm; } .ticket { width: 72mm; } }\n      body { font-family: system-ui, Arial, sans-serif; }\n    </style>\n  "),s.push("</head><body>"),s.push('<div class="ticket">'),s.push('<p style="font-weight:bold; font-size:16px; margin:0; text-align:center;">Carribar San Jorge</p>'),s.push('<p style="font-weight:bold; font-size:12px; margin:0;text-align:center;">Fecha: '+n+"</p>"),s.push('<div style="border-top:1px dashed #000; margin:4px 0 0 0;"></div>'),e.lineas.forEach(e=>{const t=l.find(t=>t.id===e.productoId);if(!t)return;const a=e.qty||1;s.push('<div style="display:flex; align-items:center; font-size:16px; font-weight:bold; margin:0;">'+'<span style="width:10%; text-align:center;">'.concat(a,"x</span>")+'<span style="width:90%; text-align:center;">'+t.nombre+"</span></div>");const o=W(e.productoId,e.mods);o&&s.push('<div style="font-size:12px; text-align:left; margin:0 0 2px 0; padding-left:2px;">&gt; '+o+"</div>"),s.push('<div style="border-bottom:1px dotted #000; margin:2px 0;"></div>')}),s.push('<div style="border-top:1px dashed #000; margin:4px 0;"></div>'),s.push('<p style="font-weight:bold; font-size:14px; margin:0;">Obs: '+(e.mensajeTicket||"")+"</p>"),s.push('<p style="font-weight:bold; font-size:14px; margin:0; text-align:left;">Lugar consumo: '+e.lugarConsumo+"</p>"),s.push("</div></body></html>"),a.document.open(),a.document.write(s.join("")),a.document.close(),setTimeout(()=>{try{a.focus(),a.print(),a.close()}catch(e){a.focus()}},50),t(e=>Object(i.a)(Object(i.a)({},e),{},{seleccionados:{},lineas:[],modificadores:{},mensajeTicket:"",pagosActuales:Object(i.a)({},p)}))},children:"Crear Comanda"}),Object(s.jsx)("button",{className:"btn-base btn-confirmar",onClick:()=>{0!==e.lineas.length?z():alert("No se puede confirmar la venta. No hay productos seleccionados.")},children:"Confirmar Venta"}),Object(s.jsxs)("button",{className:"btn-base btn-duplicar",onClick:()=>F(!0),children:["Comandas pendientes (",e.comandas.filter(e=>"pendiente"===e.estado).length,")"]})]}),Object(s.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",justifyContent:"center",alignItems:"center",gap:"8px",width:"100%",marginTop:"8px"},children:[Object(s.jsx)("button",{className:"btn-base btn-secundario",onClick:()=>t(e=>Object(i.a)(Object(i.a)({},e),{},{seleccionados:{},lineas:[],modificadores:{},mensajeTicket:"",pagosActuales:Object(i.a)({},p)})),children:"Limpiar"}),e.comandaEnProcesoId&&Object(s.jsx)("div",{className:"mt-2 p-2 border rounded bg-yellow-50 text-sm flex items-center gap-2",children:"..."}),Object(s.jsx)("button",{className:"btn-base btn-secundario",onClick:()=>{const t=e=>'"'.concat(String(null!==e&&void 0!==e?e:"").replace(/"/g,'""'),'"'),a=[["numeroVenta","fecha","hora","createdAtISO","producto","cantidad","precio","obs","lugarConsumo","medioPago"].join(";"),...e.ventas.map(e=>{var a;return[t(e.numeroVenta),t(e.fecha),t(e.hora),t(e.createdAtISO),t(e.producto),t(e.cantidad),t(e.precio),t(null!==(a=e.mensajeTicket)&&void 0!==a?a:""),t(e.lugarConsumo),t(e.medioPago)].join(";")})].join("\n"),o=document.createElement("a");o.href="data:text/csv;charset=utf-8,".concat(encodeURIComponent(a)),o.target="_blank",o.download="registro_ventas.csv",o.click()},children:"Descargar Registro"}),Object(s.jsx)("button",{className:"btn-base btn-secundario",onClick:()=>{const t=e.ventas.filter(t=>t.numeroVenta===e.numeroVentaActual-1);0!==t.length?$(t):alert("No hay ticket anterior.")},children:"Imprimir Ticket Anterior"}),Object(s.jsx)("button",{className:"btn-base btn-secundario",onClick:()=>{confirm("\xbfEst\xe1s seguro de reiniciar el registro?")&&(localStorage.removeItem("estado"),t(c))},children:"Reiniciar Registro"}),Object(s.jsx)("button",{className:"btn-base btn-secundario",onClick:()=>{const t=e.ventas.filter(e=>!e.anulada),a=new Map;t.forEach(e=>{var t;const o=null!==(t=a.get(e.producto))&&void 0!==t?t:{cantidad:0,total:0};o.cantidad+=e.cantidad,o.total+=e.cantidad*e.precio,a.set(e.producto,o)});const o=Array.from(a.entries()).map(e=>{let[t,a]=e;return{producto:t,cantidad:a.cantidad,total:a.total}}),n={};t.forEach(e=>{var t,a;const o=null!==(t=e.lugarConsumo)&&void 0!==t?t:"N/D";n[o]=(null!==(a=n[o])&&void 0!==a?a:0)+e.cantidad*e.precio});const i=Object.entries(n).map(e=>{let[t,a]=e;return{lugar:t,total:a}}),s=window.open("","ResumenVentas","width=420,height=720");if(!s)return void alert("No se pudo abrir la ventana de resumen. Revis\xe1 el bloqueador de pop-ups.");s.focus();const r=s,l=new Intl.NumberFormat("es-AR",{minimumFractionDigits:0,maximumFractionDigits:0}),c=e=>'"'+String(null!==e&&void 0!==e?e:"").replace(/"/g,'""')+'"';!function e(t){const a=[...o];"cantidad_desc"===t&&a.sort((e,t)=>t.cantidad-e.cantidad||e.producto.localeCompare(t.producto)),"total_desc"===t&&a.sort((e,t)=>t.total-e.total||e.producto.localeCompare(t.producto)),"nombre_asc"===t&&a.sort((e,t)=>e.producto.localeCompare(t.producto));const n=[];n.push('<html><head><meta charset="utf-8" />'),n.push("<title>Resumen por producto</title>"),n.push("<style>body{font-family:system-ui,Arial,sans-serif;padding:12px;}h1{font-size:16px;margin:0 0 8px;text-align:center;}h2{font-size:14px;margin:12px 0 6px;display:flex;gap:8px;align-items:center;justify-content:space-between;}table{width:100%;border-collapse:collapse;margin:6px 0;}th,td{border-bottom:1px solid #ddd;padding:4px;}th{text-align:left;}.tot{font-weight:bold;font-size:14px;padding:8px 0;text-align:right;}.muted{color:#555}.actions{margin-top:10px;display:flex;gap:8px;flex-wrap:wrap;}a.btn,button.btn{padding:6px 10px;border:1px solid #333;background:#fff;cursor:pointer;text-decoration:none;color:#111;border-radius:6px;}a.btn:hover,button.btn:hover{background:#f3f3f3}@media print{.actions,.toolbar{display:none}}.toolbar{display:flex;align-items:center;gap:8px}</style></head><body>"),n.push("<h1>Resumen por producto</h1>"),n.push('<div class="muted">Generado: '+(new Date).toLocaleString()+"</div>"),n.push('<h2><span>Por producto</span><div class="toolbar"><label for="orden">Ordenar por:</label><select id="orden"><option value="cantidad_desc"'+("cantidad_desc"===t?" selected":"")+'>Cantidad \u2193 (m\xe1s vendido)</option><option value="total_desc"'+("total_desc"===t?" selected":"")+'>Total \u2193</option><option value="nombre_asc"'+("nombre_asc"===t?" selected":"")+">Producto A\u2192Z</option></select></div></h2>"),n.push('<table><thead><tr><th>Producto</th><th style="text-align:right">Cant.</th><th style="text-align:right">Total</th></tr></thead><tbody id="tbody-productos">'),a.length?a.forEach(e=>{n.push("<tr><td>"+e.producto+'</td><td style="text-align:right">'+e.cantidad+'</td><td style="text-align:right">$'+l.format(e.total)+"</td></tr>")}):n.push('<tr><td colspan="3" class="muted">Sin ventas</td></tr>'),n.push("</tbody></table>");const s=[...i].sort((e,t)=>t.total-e.total||e.lugar.localeCompare(t.lugar));n.push('<h2>Por lugar de consumo</h2><table><thead><tr><th>Lugar</th><th style="text-align:right">Total</th></tr></thead><tbody id="tbody-lugares">'),s.length?s.forEach(e=>{n.push("<tr><td>"+e.lugar+'</td><td style="text-align:right">$'+l.format(e.total)+"</td></tr>")}):n.push('<tr><td colspan="2" class="muted">Sin ventas</td></tr>'),n.push("</tbody></table>");const d=a.reduce((e,t)=>e+t.total,0);n.push('<div class="tot" id="total-general">Total general: $'+l.format(d)+"</div>");const p=[["Producto","Cantidad","Total"].join(";"),...a.map(e=>[c(e.producto),c(e.cantidad),c(e.total)].join(";")),"","Total general;;"+c(d)].join("\n"),u="data:text/csv;charset=utf-8,"+encodeURIComponent(p),b=[["Lugar","Total"].join(";"),...s.map(e=>[c(e.lugar),c(e.total)].join(";"))].join("\n"),m="data:text/csv;charset=utf-8,"+encodeURIComponent(b);n.push('<div class="actions">'),n.push('<a class="btn" href="'+u+'" download="resumen_por_producto.csv">Descargar CSV (por producto)</a>'),n.push('<a class="btn" href="'+m+'" download="resumen_por_lugar.csv">Descargar CSV (por lugar)</a>'),n.push('<button class="btn" onclick="window.print()">Descargar PDF (Imprimir)</button>'),n.push('<button class="btn" onclick="window.close()">Cerrar</button>'),n.push("</div>"),n.push("</body></html>"),r.document.open(),r.document.write(n.join("")),r.document.close();const h=r.document.getElementById("orden");h&&(h.onchange=()=>{r.close(),e(h.value)})}("cantidad_desc")},children:"Resumen por producto"}),Object(s.jsx)("button",{className:"btn-base btn-secundario",onClick:()=>{const t=e.ventas;if(!t.length)return void alert("No hay ventas registradas.");const a={};t.forEach(e=>{a[e.numeroVenta]||(a[e.numeroVenta]=[]),a[e.numeroVenta].push(e)});const o=Object.entries(a).map(e=>{let[t,a]=e;const o=a.reduce((e,t)=>e+t.cantidad*t.precio,0),n=a.some(e=>e.anulada);return{numeroVenta:Number(t),items:a,subtotal:o,anulada:n}}).sort((e,t)=>e.numeroVenta-t.numeroVenta),n=o.reduce((e,t)=>e+t.subtotal,0),i=o.filter(e=>!e.anulada).reduce((e,t)=>e+t.subtotal,0),s=new Intl.NumberFormat("es-AR",{minimumFractionDigits:0,maximumFractionDigits:0}),r=e=>'"'+String(null!==e&&void 0!==e?e:"").replace(/"/g,'""')+'"',l=["Numero de venta","Producto","Cantidad","Precio unitario","Precio total","Medio de pago","Estado"].join(";"),c=[];o.forEach(e=>{const t=e.anulada?"".concat(e.numeroVenta," (ANULADA)"):String(e.numeroVenta);e.items.forEach(a=>{const o=a.cantidad*a.precio;c.push([r(t),r(a.producto),r(a.cantidad),r(a.precio),r(o),r(a.medioPago),r(e.anulada?"ANULADA":"VIGENTE")].join(";"))}),c.push([r("Subtotal N\xb0 "+t),"","","",r(e.subtotal),"",""].join(";")),c.push("")}),c.push([r("Total general (solo vigentes)"),"","","",r(i),"",""].join(";")),c.push([r("Total general (incl. anuladas)"),"","","",r(n),"",""].join(";"));const d="data:text/csv;charset=utf-8,"+encodeURIComponent([l,...c].join("\n")),p=window.open("","ResumenPorVenta","width=560,height=720");if(!p)return void alert("No se pudo abrir la ventana de resumen. Revis\xe1 el bloqueador de pop-ups.");p.focus();const u=p,b=[];b.push('<html><head><meta charset="utf-8"/>'),b.push("<title>Resumen por venta</title>"),b.push("<style>".concat("\n      body{font-family:system-ui,Arial,sans-serif;padding:12px;}\n      h1{font-size:16px;margin:0 0 8px;text-align:center;}\n      h2{font-size:14px;margin:12px 0 6px;}\n      table{width:100%;border-collapse:collapse;margin:6px 0;}\n      th,td{border-bottom:1px solid #ddd;padding:6px;}\n      th{text-align:left;}\n      .muted{color:#555}\n      .tot{font-weight:bold}\n      .actions{margin-top:10px;display:flex;gap:8px;flex-wrap:wrap;}\n      .btn{padding:6px 10px;border:1px solid #333;background:#fff;cursor:pointer;text-decoration:none;color:#111;border-radius:6px;}\n      .btn:hover{background:#f3f3f3}\n      @media print{.actions{display:none}}\n    ","</style></head><body>")),b.push("<h1>Resumen por venta</h1>"),b.push('<div class="muted">Generado: '+(new Date).toLocaleString()+"</div>"),b.push('<table><thead><tr><th style="text-align:center;width:110px;">N\xb0 Venta</th><th>Producto</th><th style="text-align:right;width:80px;">Cant.</th><th style="text-align:right;width:100px;">Precio unit.</th><th style="text-align:right;width:110px;">Precio total</th><th style="text-align:left;width:110px;">Medio</th><th style="text-align:left;width:90px;">Estado</th></tr></thead><tbody>'),o.length?o.forEach(e=>{b.push('<tr><td colspan="7" style="padding-top:10px;font-weight:bold;background:#f6f6f6;">Venta N\xb0 '.concat(e.numeroVenta)+(e.anulada?' <span style="color:red">(ANULADA)</span>':"")+"</td></tr>"),e.items.forEach(t=>{const a=t.cantidad*t.precio;b.push("<tr>"),b.push('<td style="text-align:center">'.concat(e.numeroVenta,"</td>")),b.push("<td>".concat(t.producto,"</td>")),b.push('<td style="text-align:right">'.concat(t.cantidad,"</td>")),b.push('<td style="text-align:right">$'.concat(s.format(t.precio),"</td>")),b.push('<td style="text-align:right">$'.concat(s.format(a),"</td>")),b.push("<td>".concat(t.medioPago,"</td>")),b.push("<td>".concat(e.anulada?"ANULADA":"VIGENTE","</td>")),b.push("</tr>")}),b.push('<tr><td colspan="5" style="text-align:right;font-weight:bold;">SUBTOTAL Venta N\xb0 '.concat(e.numeroVenta,"</td>")+'<td style="text-align:left;font-weight:bold;">$'.concat(s.format(e.subtotal),"</td>")+"<td></td></tr>"),b.push('<tr><td colspan="7" style="border-bottom:2px solid #000;"></td></tr>')}):b.push('<tr><td colspan="7" style="text-align:center;color:#555;">Sin ventas</td></tr>'),b.push('<tr><td colspan="5" font-bold style="text-align:right;color:#555;">Total general</td>'+'<td style="text-align:left;color:#555;">$'.concat(s.format(i),"</td><td></td></tr>")),b.push('<tr><td colspan="5" style="text-align:right;color:#555;">Total incluyendo anuladas</td>'+'<td style="text-align:left;color:#555;">$'.concat(s.format(n),"</td><td></td></tr>")),b.push("</tbody></table>"),b.push('<div class="actions">'+'<a class="btn" href="'.concat(d,'" download="resumen_por_venta.csv">Descargar CSV</a>')+'<button class="btn" onclick="window.print()">Descargar PDF (Imprimir)</button><button class="btn" onclick="window.close()">Cerrar</button></div>'),b.push("</body></html>"),u.document.open(),u.document.write(b.join("")),u.document.close()},children:"Resumen por venta"}),Object(s.jsx)("button",{className:"btn-base btn-secundario",onClick:()=>{const t=e.ultimoCierreISO||"1970-01-01T00:00:00.000Z",a=e.pagos.filter(e=>e.createdAtISO>t),o=new Set(e.ventas.filter(e=>e.anulada).map(e=>e.numeroVenta)),n=a.filter(e=>!o.has(e.numeroVenta));if(0===n.length)return void alert("No hay pagos de ventas vigentes desde el \xfaltimo cierre.");const i={Efectivo:0,"D\xe9bito":0,"Cr\xe9dito":0,QR:0,Cuenta:0};n.forEach(e=>{i[e.medio]+=e.monto});const s=n.reduce((e,t)=>e+t.monto,0),r=new Set(n.map(e=>e.numeroVenta)).size;v({desdeISO:t,hastaISO:(new Date).toISOString(),cantidadVentas:r,totalesPorMedio:i,totalGeneral:s}),k({b100:"",b200:"",b500:"",b1000:"",b2000:"",b10000:"",b20000:""}),N({bica:"",mp:"",macro:""}),y(!0)},children:"Cierre de caja"})]}),L&&Object(s.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[Object(s.jsx)("div",{className:"absolute inset-0 bg-black/50",onClick:Q}),Object(s.jsxs)("div",{className:"relative z-10 w-[95%] max-w-2xl bg-white rounded-xl shadow-xl border border-gray-200 p-4",children:[Object(s.jsx)("h3",{className:"text-lg font-semibold text-center",children:"Comandas"}),Object(s.jsxs)("div",{className:"mt-2 flex items-center gap-2",children:[Object(s.jsx)("input",{type:"text",placeholder:"Buscar por fecha (DD-MM-YYYY) o nro sugerido...",value:B,onChange:e=>q(e.target.value),className:"flex-1 border rounded p-2"}),Object(s.jsx)("button",{className:"px-3 py-2 rounded-md border",onClick:()=>q(""),children:"Limpiar"})]}),Object(s.jsx)("div",{className:"mt-3 max-h-[60vh] overflow-auto divide-y",children:e.comandas.filter(e=>{if("anulada"===e.estado)return!1;if(!B)return!0;const t=B.trim().toLowerCase();return e.fecha.toLowerCase().includes(t)||String(e.numeroSugerido).includes(t)}).sort((e,t)=>t.createdAtISO.localeCompare(e.createdAtISO)).map(e=>{const a=D(e);return Object(s.jsxs)("div",{className:"py-3",children:[Object(s.jsxs)("div",{className:"flex justify-between items-center",children:[Object(s.jsxs)("div",{className:"text-sm",children:[Object(s.jsx)("div",{className:"font-semibold",children:"pendiente"===e.estado?"\ud83d\udfe1 Pendiente":"\ud83d\udfe2 Cobrada"}),Object(s.jsxs)("div",{className:"text-gray-600",children:[e.alias&&Object(s.jsx)("div",{className:"text-gray-900 font-bold",children:e.alias}),e.fecha," ",e.hora," \u2014 sugerida N\xb0"," ",e.numeroSugerido]}),Object(s.jsxs)("div",{className:"text-gray-600",children:["\xcdtems:"," ",e.lineas.reduce((e,t)=>e+(t.qty||1),0)," ","\u2014 Total aprox: $",u(a)]}),e.obs&&Object(s.jsxs)("div",{className:"text-gray-700",children:[Object(s.jsx)("b",{children:"Obs:"})," ",e.obs]})]}),Object(s.jsxs)("div",{className:"flex gap-2",children:["pendiente"===e.estado&&Object(s.jsxs)(s.Fragment,{children:[Object(s.jsx)("button",{className:"bg-blue-600 hover:bg-blue-700 text-white text-xs font-bold py-1 px-3 rounded",onClick:()=>H(e.id),title:"Cargar al carrito",children:"Cargar"}),Object(s.jsx)("button",{className:"bg-green-600 hover:bg-green-700 text-white text-xs font-bold py-1 px-3 rounded",onClick:()=>{return t=e.id,H(t),void setTimeout(()=>z(),0);var t},title:"Cargar y cobrar",children:"Confirmar"})]}),Object(s.jsx)("button",{className:"bg-red-600 hover:bg-red-700 text-white text-xs font-bold py-1 px-3 rounded",onClick:()=>{return a=e.id,void t(e=>Object(i.a)(Object(i.a)({},e),{},{comandas:e.comandas.filter(e=>e.id!==a),comandaEnProcesoId:e.comandaEnProcesoId===a?null:e.comandaEnProcesoId}));var a},title:"Eliminar",children:"Eliminar"})]})]}),Object(s.jsxs)("ul",{className:"mt-2 text-xs text-gray-700 list-disc pl-5",children:[e.lineas.slice(0,4).map(e=>{var t;const a=l.find(t=>t.id===e.productoId);return Object(s.jsxs)("li",{children:[e.qty||1,"\xd7"," ",null!==(t=null===a||void 0===a?void 0:a.nombre)&&void 0!==t?t:"Prod "+e.productoId]},e.uid)}),e.lineas.length>4&&Object(s.jsxs)("li",{children:["\u2026 y ",e.lineas.length-4," m\xe1s"]})]})]},e.id)})}),Object(s.jsx)("div",{className:"mt-4 flex justify-end",children:Object(s.jsx)("button",{className:"px-3 py-2 rounded-md border",onClick:Q,children:"Cerrar"})})]})]}),a&&Object(s.jsx)("div",{style:{fontFamily:"Montserrat, sans-serif",position:"fixed",inset:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9999,padding:10},onClick:P,children:Object(s.jsxs)("div",{onClick:e=>e.stopPropagation(),style:{fontFamily:"Montserrat, sans-serif",background:"white",width:"100%",maxWidth:"420px",borderRadius:"10px",border:"1px solid #d90f0fff",padding:"16px",boxShadow:"0 4px 12px rgba(0,0,0,0.3)"},children:[Object(s.jsx)("h3",{style:{fontSize:18,fontWeight:"bold",textAlign:"center"},children:"Cobro de la venta"}),Object(s.jsxs)("div",{style:{fontFamily:"Montserrat, sans-serif",fontSize:18,color:"#ff2727",textAlign:"center",marginTop:4,marginBottom:8},children:["TOTAL A COBRAR: ",Object(s.jsxs)("b",{children:["$",u(V())]})]}),Object(s.jsx)("div",{style:{marginTop:8},children:d.map(e=>Object(s.jsxs)("div",{style:{fontFamily:"Montserrat, sans-serif",color:"#26608e",display:"flex",gap:8,alignItems:"center",marginBottom:6},children:[Object(s.jsx)("label",{style:{width:80},children:e}),Object(s.jsx)("input",{type:"number",min:0,step:"1",inputMode:"numeric",style:{flex:1,padding:6,borderRadius:4,border:"1px solid #a73332"},value:g[e]?g[e]:"",onChange:t=>j(a=>Object(i.a)(Object(i.a)({},a),{},{[e]:Number(t.target.value)||0}))})]},e))}),(()=>{const e=V(),t=m(g),a=e-t,o=Math.max(a,0),n=Math.max(-a,0);return Object(s.jsxs)("div",{style:{marginTop:10,paddingTop:8,borderTop:"1px solid #cd2c2cff",fontSize:14},children:[Object(s.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:2},children:[Object(s.jsx)("span",{children:"Sumatoria"}),Object(s.jsxs)("span",{children:["$",u(t)]})]}),Object(s.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:2,color:o>0?"#b91c1c":"#555",fontWeight:o>0?"bold":"normal"},children:[Object(s.jsx)("span",{children:"Pendiente"}),Object(s.jsxs)("span",{children:["$",u(o)]})]}),Object(s.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",color:n>0?"#1d4ed8":"#555",fontWeight:n>0?"bold":"normal"},children:[Object(s.jsx)("span",{children:"Vuelto"}),Object(s.jsxs)("span",{children:["$",u(n)]})]})]})})(),Object(s.jsxs)("div",{style:{marginTop:12,display:"flex",justifyContent:"flex-end",gap:8,flexWrap:"wrap"},children:[Object(s.jsx)(h,{bg:"#e9e1d7",color:"#12860c",hoverBg:"#12860c",hoverColor:"#e9e1d7",onClick:()=>j(Object(i.a)({},p)),children:"Borrar"}),Object(s.jsx)(h,{bg:"#e9e1d7",color:"#12860c",hoverBg:"#12860c",hoverColor:"#e9e1d7",onClick:()=>j(Object(i.a)(Object(i.a)({},p),{},{Efectivo:V()})),children:"Efectivo = Total"}),Object(s.jsx)(h,{bg:"#e9e1d7",color:"#12860c",hoverBg:"#12860c",hoverColor:"#e9e1d7",onClick:P,children:"Cancelar"}),Object(s.jsx)(h,{bg:"#e9e1d7",color:"#12860c",hoverBg:"#12860c",hoverColor:"#e9e1d7",onClick:()=>{const a=V(),o=g,s=m(o);if(s<=0)return void alert("Ingres\xe1 al menos un monto en los medios de pago.");if(s<a)return void alert("La suma de los medios es menor que el total.");const r=(o["D\xe9bito"]||0)+(o["Cr\xe9dito"]||0)+(o.QR||0)+(o.Cuenta||0),c=Math.max(0,a-r),h=o.Efectivo||0,j=Math.max(0,h-c),x=d.filter(e=>(o[e]||0)>0),y=1===x.length?x[0]:"Mixto",{fecha:f,hora:v,createdAtISO:O}=b(),C=e.lineas.map(t=>{var a,o;const n=l.find(e=>e.id===t.productoId),s=_(t.productoId,t.mods),r=W(t.productoId,t.mods);return{fecha:f,hora:v,createdAtISO:O,producto:null!==(a=null===n||void 0===n?void 0:n.nombre)&&void 0!==a?a:"",cantidad:t.qty||1,precio:(null!==(o=null===n||void 0===n?void 0:n.precio)&&void 0!==o?o:0)+s,numeroVenta:e.numeroVentaActual,mensajeTicket:r||"",lugarConsumo:e.lugarConsumo,medioPago:y,productId:t.productoId,mods:Object(i.a)({},t.mods)}}),k=d.filter(e=>(o[e]||0)>0).map(t=>({numeroVenta:e.numeroVentaActual,medio:t,monto:o[t],createdAtISO:O}));j>0&&alert("Vuelto: $".concat(u(j))),S({numeroVenta:e.numeroVentaActual,ventas:C,pagos:o,total:a,vuelto:j}),$(C,o),t(e=>{let t=e.comandas;return e.comandaEnProcesoId&&(t=e.comandas.map(t=>t.id===e.comandaEnProcesoId?Object(i.a)(Object(i.a)({},t),{},{estado:"cobrada"}):t)),Object(i.a)(Object(i.a)({},e),{},{ventasAnteriores:[...e.ventas],ventas:[...e.ventas,...C],pagos:[...e.pagos,...k],seleccionados:{},lineas:[],numeroVentaActual:e.numeroVentaActual+1,mensajeTicket:"",montoPagado:s,pagosActuales:Object(i.a)({},p),comandas:t,comandaEnProcesoId:null})}),n(!1)},children:"Confirmar"})]})]})}),x&&f&&Object(s.jsx)("div",{style:{fontFamily:"Montserrat, sans-serif",position:"fixed",inset:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9999,padding:10},onClick:()=>{y(!1),v(null)},children:Object(s.jsxs)("div",{onClick:e=>e.stopPropagation(),style:{fontFamily:"Montserrat, sans-serif",background:"white",width:"100%",maxWidth:"720px",borderRadius:"10px",border:"1px solid #d90f0fff",padding:"16px",boxShadow:"0 4px 12px rgba(0,0,0,0.3)"},children:[Object(s.jsx)("h3",{style:{fontSize:18,fontWeight:"bold",textAlign:"center"},children:"Cierre de caja con conteo"}),Object(s.jsxs)("div",{style:{fontSize:12,color:"#555",textAlign:"center",marginTop:4,marginBottom:8},children:["Desde: ",Object(s.jsx)("b",{children:f.desdeISO})," \u2014 Hasta:"," ",Object(s.jsx)("b",{children:f.hastaISO})," \u2014 Tickets:"," ",Object(s.jsx)("b",{children:f.cantidadVentas})]}),Object(s.jsxs)("div",{style:{marginTop:12},children:[Object(s.jsx)("h4",{style:{fontWeight:700,fontSize:14},children:"Totales del sistema"}),Object(s.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(170px, 1fr))",gap:8,marginTop:6,fontSize:14},children:["Efectivo","D\xe9bito","Cr\xe9dito","QR","Cuenta"].map(e=>{var t;return Object(s.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",border:"1px solid #ddd",borderRadius:6,padding:"6px 8px"},children:[Object(s.jsx)("span",{children:e}),Object(s.jsxs)("span",{children:["$",u(null!==(t=f.totalesPorMedio[e])&&void 0!==t?t:0)]})]},e)})}),Object(s.jsxs)("div",{style:{marginTop:8,display:"flex",justifyContent:"space-between",fontWeight:700,fontSize:14},children:[Object(s.jsx)("span",{children:"Total general"}),Object(s.jsxs)("span",{children:["$",u(f.totalGeneral)]})]})]}),Object(s.jsxs)("div",{style:{marginTop:16},children:[Object(s.jsx)("h4",{style:{fontWeight:700,fontSize:14},children:"Efectivo (cantidades de billetes)"}),Object(s.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(120px, 1fr))",gap:8,marginTop:6,fontSize:14},children:[{k:"b100",l:"$100"},{k:"b200",l:"$200"},{k:"b500",l:"$500"},{k:"b1000",l:"$1.000"},{k:"b2000",l:"$2.000"},{k:"b10000",l:"$10.000"},{k:"b20000",l:"$20.000"}].map(e=>{var t;let{k:a,l:o}=e;return Object(s.jsxs)("label",{style:{fontSize:14},children:[Object(s.jsx)("span",{style:{marginRight:6},children:o}),Object(s.jsx)("input",{type:"number",min:0,inputMode:"numeric",style:{width:"100%",padding:6,borderRadius:4,border:"1px solid #a73332",marginTop:4},value:null!==(t=C[a])&&void 0!==t?t:"",onChange:e=>k(t=>Object(i.a)(Object(i.a)({},t),{},{[a]:e.target.value})),placeholder:"cant."})]},a)})}),Object(s.jsxs)("div",{style:{marginTop:8,display:"flex",justifyContent:"space-between",fontSize:14},children:[Object(s.jsx)("span",{children:"Total efectivo contado"}),Object(s.jsxs)("span",{style:{fontWeight:700},children:["$",u(M())]})]})]}),Object(s.jsxs)("div",{style:{marginTop:16},children:[Object(s.jsx)("h4",{style:{fontWeight:700,fontSize:14},children:"Cuentas"}),Object(s.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(160px, 1fr))",gap:8,marginTop:6,fontSize:14},children:[{k:"bica",label:"Bica"},{k:"mp",label:"MP"},{k:"macro",label:"Macro"}].map(e=>{var t;let{k:a,label:o}=e;return Object(s.jsxs)("label",{style:{fontSize:14},children:[Object(s.jsx)("span",{style:{marginRight:6},children:o}),Object(s.jsx)("input",{type:"number",min:0,inputMode:"numeric",style:{width:"100%",padding:6,borderRadius:4,border:"1px solid #a73332",marginTop:4},value:null!==(t=w[a])&&void 0!==t?t:"",onChange:e=>N(t=>Object(i.a)(Object(i.a)({},t),{},{[a]:e.target.value})),placeholder:"$"})]},a)})})]}),Object(s.jsxs)("div",{style:{marginTop:16,border:"1px solid #ddd",borderRadius:8,padding:10,fontSize:14},children:[Object(s.jsx)("h4",{style:{fontWeight:700,fontSize:14,marginBottom:6},children:"Resumen global"}),Object(s.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[Object(s.jsx)("span",{children:"Total del sistema"}),Object(s.jsxs)("span",{children:["$",u(f.totalGeneral)]})]}),Object(s.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[Object(s.jsx)("span",{children:"Total contado (Efvo + MP + Cuentas)"}),Object(s.jsxs)("span",{children:["$",u(M()+Number(w.mp||0)+A())]})]}),(()=>{const e=M()+Number(w.mp||0)+A()-f.totalGeneral,t=0===e?"#166534":"#991b1b";return Object(s.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",fontWeight:700,color:t},children:[Object(s.jsx)("span",{children:"Diferencia (contado - sistema)"}),Object(s.jsxs)("span",{children:["$",u(e)]})]})})()]}),Object(s.jsxs)("div",{style:{marginTop:12,display:"flex",justifyContent:"flex-end",gap:8,flexWrap:"wrap"},children:[Object(s.jsx)(h,{bg:"#e9e1d7",color:"#12860c",hoverBg:"#12860c",hoverColor:"#e9e1d7",onClick:()=>{y(!1),v(null)},children:"Cancelar"}),Object(s.jsx)(h,{bg:"#e9e1d7",color:"#12860c",hoverBg:"#12860c",hoverColor:"#e9e1d7",onClick:()=>{if(!f)return void y(!1);const e=new Intl.NumberFormat("es-AR",{minimumFractionDigits:0,maximumFractionDigits:0}),a=(f.totalesPorMedio.Efectivo,M()),o=(f.totalesPorMedio.QR,Number(w.mp||0)),n=(f.totalesPorMedio.Cuenta,A()),s=a+o+n,r=f.totalGeneral,l=s-r,c=window.open("","CierreCaja","width=460,height=720");if(!c)return void alert("Bloqueador de pop-ups.");const d=[];d.push('<html><head><meta charset="utf-8"/><title>Cierre de caja</title>'),d.push("<style>".concat("\n      body{font-family:system-ui,Arial,sans-serif;padding:12px;}\n      h1{font-size:16px;margin:0 0 8px;text-align:center;}\n      h2{font-size:14px;margin:12px 0 6px;}\n      table{width:100%;border-collapse:collapse;margin:6px 0;}\n      th,td{border-bottom:1px solid #ddd;padding:6px;}\n      th{text-align:left;}\n      .grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;}\n      .muted{color:#555}\n      .ok{color:#166534;font-weight:bold}\n      .bad{color:#991b1b;font-weight:bold}\n      .actions{margin-top:10px;display:flex;gap:8px;flex-wrap:wrap;}\n      .btn{padding:6px 10px;border:1px solid #333;background:#fff;cursor:pointer;text-decoration:none;color:#111;border-radius:6px;}\n      .btn:hover{background:#f3f3f3}\n      @media print{.actions{display:none}}\n    ","</style></head><body>")),d.push("<h1>Cierre de caja</h1>"),d.push("<div>Desde: ".concat(f.desdeISO,"</div>")),d.push("<div>Hasta: ".concat(f.hastaISO,"</div>")),d.push("<div>Tickets incluidos: ".concat(f.cantidadVentas,"</div>")),d.push("<h2>Totales del sistema</h2>"),d.push('<table><thead><tr><th>Medio</th><th style="text-align:right">Total</th></tr></thead><tbody>');var p;["Efectivo","D\xe9bito","Cr\xe9dito","QR","Cuenta"].forEach(t=>{var a;d.push("<tr><td>".concat(t,'</td><td style="text-align:right">$').concat(e.format(null!==(a=f.totalesPorMedio[t])&&void 0!==a?a:0),"</td></tr>"))}),d.push('<tr><td style="font-weight:bold">Total general</td><td style="text-align:right;font-weight:bold">$'.concat(e.format(f.totalGeneral),"</td></tr>")),d.push("</tbody></table>"),d.push("<h2>Conteo realizado</h2>"),d.push('<div class="grid">'),d.push('<div>Efectivo contado</div><div style="text-align:right">$'.concat(e.format(a),"</div>")),d.push('<div>MP (contado)</div><div style="text-align:right">$'.concat(e.format(o),"</div>")),d.push('<div>Bica + Macro (contado)</div><div style="text-align:right">$'.concat(e.format(n),"</div>")),d.push("</div>"),d.push("<h2>Resumen</h2>"),d.push("<table><tbody>"),d.push('<tr><td>Total del sistema</td><td style="text-align:right">$'.concat(e.format(r),"</td></tr>")),d.push('<tr><td>Total contado (Efvo + MP + Cuentas)</td><td style="text-align:right">$'.concat(e.format(s),"</td></tr>")),d.push('<tr><td><b>Diferencia (contado - sistema)</b></td><td class="'.concat((p=l,0===p?"ok":"bad"),'" style="text-align:right"><b>$').concat(e.format(l),"</b></td></tr>")),d.push("</tbody></table>"),d.push('<div class="actions">'),d.push('<button class="btn" onclick="window.print()">Imprimir / PDF</button>'),d.push('<button class="btn" onclick="window.close()">Cerrar</button>'),d.push("</div>"),d.push("</body></html>"),c.document.write(d.join("")),c.document.close(),c.focus();const u={id:f.hastaISO,desdeISO:f.desdeISO,hastaISO:f.hastaISO,totalesPorMedio:f.totalesPorMedio,totalGeneral:f.totalGeneral,cantidadVentas:f.cantidadVentas};t(e=>Object(i.a)(Object(i.a)({},e),{},{cierresCaja:[...e.cierresCaja,u],ultimoCierreISO:f.hastaISO})),y(!1),v(null)},children:"Confirmar y cerrar per\xedodo"})]})]})}),O&&Object(s.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[Object(s.jsx)("div",{className:"absolute inset-0 bg-black/50",onClick:()=>S(null)}),Object(s.jsxs)("div",{className:"relative z-10 w-[95%] max-w-md bg-white rounded-xl shadow-xl border border-gray-500 p-4",children:[Object(s.jsxs)("h3",{className:"text-lg font-semibold text-center mb-2",children:["Venta N\xb0 ",O.numeroVenta]}),O.ventas.length>0&&Object(s.jsxs)("div",{className:"text-xs text-gray-600 text-center mb-2",children:[Object(s.jsxs)("div",{children:["Fecha: ",Object(s.jsx)("b",{children:O.ventas[0].fecha})," \u2014 Hora:"," ",Object(s.jsx)("b",{children:O.ventas[0].hora})]}),Object(s.jsxs)("div",{children:["Lugar de consumo:"," ",Object(s.jsx)("b",{children:O.ventas[0].lugarConsumo})]})]}),Object(s.jsxs)("div",{className:"mt-2 border-t pt-2",children:[Object(s.jsx)("h4",{className:"text-sm font-semibold mb-1",children:"Detalle de productos"}),Object(s.jsx)("ul",{className:"text-sm space-y-1 max-h-48 overflow-auto",children:O.ventas.map((e,t)=>Object(s.jsxs)("li",{className:"flex flex-col border-b last:border-b-0 pb-1",children:[Object(s.jsxs)("div",{className:"flex justify-between",children:[Object(s.jsxs)("span",{children:[e.cantidad,"\xd7 ",e.producto]}),Object(s.jsxs)("span",{children:["$",u(e.cantidad*e.precio)]})]}),e.mensajeTicket&&Object(s.jsxs)("span",{className:"text-xs text-gray-600",children:["> ",e.mensajeTicket]})]},t))})]}),Object(s.jsxs)("div",{className:"mt-3 border-t pt-2 text-sm space-y-1",children:[Object(s.jsxs)("div",{className:"flex justify-between font-semibold",children:[Object(s.jsx)("span",{children:"Total"}),Object(s.jsxs)("span",{children:["$",u(O.total)]})]}),O.vuelto>0&&Object(s.jsxs)("div",{className:"flex justify-between text-blue-700 font-semibold",children:[Object(s.jsx)("span",{children:"Vuelto"}),Object(s.jsxs)("span",{children:["$",u(O.vuelto)]})]}),Object(s.jsxs)("div",{className:"mt-2",children:[Object(s.jsx)("h4",{className:"text-sm font-semibold mb-1",children:"Medios de pago"}),Object(s.jsxs)("div",{className:"space-y-1",children:[d.filter(e=>(O.pagos[e]||0)>0).map(e=>Object(s.jsxs)("div",{className:"flex justify-between text-sm",children:[Object(s.jsx)("span",{children:e}),Object(s.jsxs)("span",{children:["$",u(O.pagos[e]||0)]})]},e)),d.every(e=>0===(O.pagos[e]||0))&&Object(s.jsx)("div",{className:"text-xs text-gray-500",children:"(Sin detalle de medios de pago)"})]})]})]}),Object(s.jsx)("div",{className:"mt-4 flex justify-end gap-2",children:Object(s.jsx)("button",{className:"px-3 py-2 rounded-md border",onClick:()=>S(null),children:"Cerrar"})})]})]})]})})};const j=document.getElementById("root");if(j){Object(n.createRoot)(j).render(Object(s.jsx)(o.StrictMode,{children:Object(s.jsx)(g,{})}))}else console.error("\u274c No se encontr\xf3 el elemento #root en index.html")}},[[15,1,2]]]);
//# sourceMappingURL=main.95540dc7.chunk.js.map